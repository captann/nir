<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Code Analysis Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .section {
            background-color: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .item {
            border-left: 3px solid #2196F3;
            padding: 10px;
            margin: 10px 0;
            background-color: #f8f9fa;
        }
        .item:hover {
            background-color: #e9ecef;
        }
        .item h3 {
            margin: 0;
            color: #2196F3;
        }
        .item p {
            margin: 5px 0;
        }
        .item .meta {
            font-size: 0.9em;
            color: #666;
        }
        .item .links {
            margin-top: 10px;
            font-size: 0.9em;
        }
        .item .tags {
            margin-top: 5px;
        }
        .tag {
            display: inline-block;
            padding: 2px 8px;
            margin: 2px;
            background-color: #e3f2fd;
            border-radius: 3px;
            font-size: 0.8em;
        }
        .deprecated {
            border-left-color: #dc3545;
        }
        .deprecated h3 {
            color: #dc3545;
        }
        .warning {
            color: #856404;
            background-color: #fff3cd;
            padding: 5px;
            margin-top: 5px;
            border-radius: 3px;
        }
        .tabs {
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background-color: #e9ecef;
            border: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 5px;
        }
        .tab.active {
            background-color: #2196F3;
            color: white;
        }
        .search {
            margin-bottom: 20px;
        }
        .search input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Code Analysis Viewer</h1>
        
        <div class="search">
            <input type="text" id="searchInput" placeholder="Search for items...">
        </div>

        <div class="tabs">
            <button class="tab active" data-type="functions">Functions</button>
            <button class="tab" data-type="constants">Constants</button>
            <button class="tab" data-type="variables">Variables</button>
            <button class="tab" data-type="structures">Structures</button>
        </div>

        <div id="content"></div>
    </div>

    <script>
        let codeData = null;
        let currentType = 'functions';

        async function loadData() {
            try {
                const response = await fetch('code_data.json');
                codeData = await response.json();
                displayItems();
            } catch (error) {
                console.error('Error loading data:', error);
            }
        }

        function displayItems(searchTerm = '') {
            const contentDiv = document.getElementById('content');
            contentDiv.innerHTML = '';

            if (!codeData) return;

            const items = codeData[currentType] || [];
            const filteredItems = searchTerm
                ? items.filter(item => 
                    item.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    item.description.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    (item.comments && item.comments.toLowerCase().includes(searchTerm.toLowerCase())))
                : items;

            filteredItems.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = `item${item.deprecated ? ' deprecated' : ''}`;

                let html = `
                    <h3>${item.name}</h3>
                    <p class="meta">File: ${item.file_path}</p>
                `;

                if (item.description) {
                    html += `<p>${item.description}</p>`;
                }

                if (item.comments) {
                    html += `<p><strong>Comments:</strong> ${item.comments}</p>`;
                }

                if (item.warnings) {
                    html += `<div class="warning">${item.warnings}</div>`;
                }

                if (item.links_in_code && item.links_in_code.length > 0) {
                    html += '<div class="links"><strong>References:</strong><ul>';
                    item.links_in_code.forEach(link => {
                        html += `<li>${link.file_path}:${link.line_number} - ${link.context}</li>`;
                    });
                    html += '</ul></div>';
                }

                if (item.tags && item.tags.length > 0) {
                    html += '<div class="tags">';
                    item.tags.forEach(tag => {
                        html += `<span class="tag">${tag}</span>`;
                    });
                    html += '</div>';
                }

                // Type-specific information
                switch (currentType) {
                    case 'functions':
                        if (item.input_params && item.input_params.length > 0) {
                            html += '<p><strong>Input Parameters:</strong></p><ul>';
                            item.input_params.forEach(param => {
                                html += `<li>${param.name}: ${param.type}</li>`;
                            });
                            html += '</ul>';
                        }
                        if (item.output_params && item.output_params.length > 0) {
                            html += '<p><strong>Output Parameters:</strong></p><ul>';
                            item.output_params.forEach(param => {
                                html += `<li>${param.name}: ${param.type}</li>`;
                            });
                            html += '</ul>';
                        }
                        break;
                    case 'structures':
                        if (item.fields && item.fields.length > 0) {
                            html += '<p><strong>Fields:</strong></p><ul>';
                            item.fields.forEach(field => {
                                html += `<li>${field.name}: ${field.type}</li>`;
                            });
                            html += '</ul>';
                        }
                        break;
                }

                itemDiv.innerHTML = html;
                contentDiv.appendChild(itemDiv);
            });
        }

        // Event Listeners
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', (e) => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                e.target.classList.add('active');
                currentType = e.target.dataset.type;
                displayItems(document.getElementById('searchInput').value);
            });
        });

        document.getElementById('searchInput').addEventListener('input', (e) => {
            displayItems(e.target.value);
        });

        // Load data when page loads
        loadData();
    </script>
</body>
</html>
